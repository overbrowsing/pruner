function pruner(){let e=[...document.querySelectorAll("[data-pruner]")],r={},t=e=>r[e]?Promise.resolve(r[e]):new Promise((t,a)=>{let n=new Image;n.crossOrigin="anonymous",n.onload=()=>{r[e]=n,t(n)},n.onerror=()=>a(`Failed to load: ${e}`),n.src=e}),a=(e,r)=>Object.assign(document.createElement("canvas"),{width:e,height:r}),n=()=>({w:innerWidth,h:innerHeight}),o=async(e,r,n,o)=>{let{imageName:i,cols:c,rows:d,tileWidth:m,tileHeight:u,mobileScale:$,imagePath:g,roi:h,imageExtension:f}=JSON.parse(e.dataset.pruner);if(!(c&&d&&m&&u&&g&&i))return console.error("Missing params.");let p=r&&$?$:1,E=Math.round(m*p),w=Math.round(u*p),b=Math.min(Math.ceil(n/E),c),v=Math.min(Math.ceil(o/w),d),x=a(b*E,v*w),y=x.getContext("2d");y.imageSmoothingEnabled=!1,e.src="";let _=f||"webp",L=Array.from({length:c*d},(e,r)=>`${g}${i}-${r+1}.${_}`),[I,S]=h?l(h-1,c,v,b,d):s(c,d,v,b),q=[];for(let z=0;z<v;z++)for(let A=0;A<b;A++){let B=I+z,C=S+A;if(B<d&&C<c){let D=L[B*c+C];q.push(t(D))}}try{let F=await Promise.all(q);F.forEach((e,r)=>y.drawImage(e,r%b*E,Math.floor(r/b)*w,E,w)),e.src=x.toDataURL("image/WEBP")}catch(M){console.error(M)}},l=(e,r,t,a,n)=>[Math.min(Math.max(0,(e/r|0)-(t/2|0)),n-t),Math.min(Math.max(0,e%r-(a/2|0)),r-a)],s=(e,r,t,a)=>[Math.max(0,(r/2|0)-(t/2|0)),Math.max(0,(e/2|0)-(a/2|0))],i=debounce(()=>{let{w:r,h:t}=n();e.forEach(e=>{let{mobileBreakpoint:a}=JSON.parse(e.dataset.pruner);o(e,a&&r<=a,r,t)})},200),c=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(i(),c.unobserve(e.target))})});window.addEventListener("load",i),e.forEach(e=>c.observe(e)),window.addEventListener("resize",i)}const debounce=(e,r)=>{let t;return(...a)=>{clearTimeout(t),t=setTimeout(()=>e(...a),r)}};window.onload=pruner;